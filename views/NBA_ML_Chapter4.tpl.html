<section class="container">
    <div class="row margin10">
        <div class="col-xs-12">
            <a class="pull-left" ui-sref="blog.NBA_Machine_Learning_Tutorial3">
            <i class="fa fa-arrow-left"></i>Output Data
            </a>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <h2 class="heading multiColor" class="heading multiColor" id="structure-data">Machine Learning</h2>
            <p>I want to mention this before continuing. When it comes to programming the machine learning portion, it's actually extremely easy and fast. This tutorial will not teach you everything you need to know about machine learning, it will simply show you how to implement it. If you want to continue with machine learning, I will be referencing free online courses, tutorials, and articles that I read that helped me along the way. </p>
            <p>As of right now, we have read in data from CSV files. We cleaned the data, we structured the data, and we exported the data. I've been waiting days to say this, now lets do something with the data!</p>
            <p>Before we start I want to go on the record about something. If I told you that I was a <strong><em>PYTHON GURU</em></strong>, I would be <strong><em>lying like the rug</em></strong>.</p>
            <p>With the exception of a <a href="https://www.codecademy.com/learn">Codecademy</a> and "Hello World!" type programs, this is my first real program with Python. I apologize if some of my code is very <strong><em>noob-ish</em></strong>. If anyone knows a better way of implementing some of my code, by all means, make a pull request to the repo.</p>
            <p>You can clone the new repo or simply create these two new files:</p>
            <div class="directorySection">
                <p><i class="fa fa-file tabOver"></i> nbaImport.py</p>
                <p><i class="fa fa-file tabOver"></i> runNBA_Data.py</p>
            </div>
            <p>In <code>nbaImport.py</code>, we will have two variables and the methods we need in order to connect to mongo. so lets get started with that. Add this comment section at the top of the page:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:245px">'''
PER
    FGM - totals.FG
    Stl - totals.STL
    3PTM - totals.3P
    FTM - totals.FT
    Blk - totals.BLK
    Off_Reb - totals.ORB
    Ast - totals.AST
    Def_Reb - totals.DRB
    Foul - totals.PF
    FT_Miss - totals.FTA-totals.FT
    FG_Miss - totals.FGA-totals.FG
    TO - totals.TOV
'''</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>These are the stats from <a href="http://bleacherreport.com/articles/113144-cracking-the-code-how-to-calculate-hollingers-per-without-all-the-mess">Zach Fien article</a> from <a ui-sref="blog.NBA_Machine_Learning_Tutorial1" title="Chapter 1">Chapter 1</a> along with their property names in the database.</p>
            <p>The following methods will connect us to our mongoDB. I followed this <a href="http://stackoverflow.com/a/16255680/1973339">stack overflow answer</a> as a guide to connect to mongoDB. It's pretty straight forward, I made a few tweaks to it. Add the following methods to <code>nbaImport.py</code></p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:500px"># Connect to MongoDB
def connectMongo(db, host='localhost', port=27017, mongo_uri=None):

    """ A util for making a connection to mongo """

    if mongo_uri:
        conn = MongoClient(mongo_uri)
    else:
        conn = MongoClient(host, port)

    return conn[db]

def readMongo(db, collection, query={}, queryReturn=None,
                _limit=None,no_id=True,mongo_uri=None):

    """ Read from Mongo and Store into DataFrame """

    # Connect to MongoDB
    db = connectMongo(db=db, mongo_uri=mongo_uri)

    # Make a query to the specific DB and Collection
    cursor = db[collection].find(query, queryReturn)

    # Check if a limit was set
    if _limit:
        cursor = cursor.limit(_limit)
    # Expand the cursor and construct the DataFrame
    df =  pd.DataFrame(list(cursor))

    # Delete the _id
    if no_id:
        del df['_id']

    return df</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>I will explain <code>DataFrame</code> when we get to <code>runNBA_Data.py</code>. Almost forgot, add these imports at the top of <code>nbaImport.py</code>:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:50px">import pandas as pd
from pymongo import MongoClient
from bson.objectid import ObjectId</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>So we have our database methods set. We know what stats we need to get and from what collection. Now we just have to query them. Add the following variables:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:500px">PER_FEATURES = [
    'FG',
    'STL',
    '3P',
    'FT',
    'BLK',
    'ORB',
    'AST',
    'DRB',
    'PF',
    'FT_M', #FT_Miss - totals.FTA-totals.FT
    'FG_M', #FG_Miss - totals.FGA-totals.FG
    'TOV',
    'MP'
]

WANTED_FEATURES = {
    'Seasons.advanced.PER': 1,  # double
    'Seasons.totals.MP': 1,     # Int32
    'Seasons.totals.STL': 1,    # Int32
    'Seasons.totals.3P': 1,     # Int32
    'Seasons.totals.FT': 1,     # Int32
    'Seasons.totals.BLK': 1,    # Int32
    'Seasons.totals.ORB': 1,    # Int32
    'Seasons.totals.AST': 1,    # Int32
    'Seasons.totals.DRB': 1,    # Int32
    'Seasons.totals.PF': 1,     # Int32
    'Seasons.totals.FTA': 1,    # Int32
    'Seasons.totals.FGA': 1,    # Int32
    'Seasons.totals.FG': 1,     # Int32
    'Seasons.totals.TOV': 1     # Int32
}</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>That's pretty much it when it comes to <code>nbaImport.py</code>, we'll do a code checkup right now.</p>
            <h3 class="heading multiColor" id="code-checkup">Code Checkup</h3>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:500px">import pandas as pd
from pymongo import MongoClient
from bson.objectid import ObjectId

'''
PER
    FGM - totals.FG
    Stl - totals.STL
    3PTM - totals.3P
    FTM - totals.FT
    Blk - totals.BLK
    Off_Reb - totals.ORB
    Ast - totals.AST
    Def_Reb - totals.DRB
    Foul - totals.PF
    FT_Miss - totals.FTA-totals.FT
    FG_Miss - totals.FGA-totals.FG
    TO - totals.TOV
'''

PER_FEATURES = [
    'FG',
    'STL',
    '3P',
    'FT',
    'BLK',
    'ORB',
    'AST',
    'DRB',
    'PF',
    'FT_M', #FT_Miss - totals.FTA-totals.FT
    'FG_M', #FG_Miss - totals.FGA-totals.FG
    'TOV',
    'MP'
]

WANTED_FEATURES = {
    'Seasons.advanced.PER': 1,  # double
    'Seasons.totals.MP': 1,     # Int32
    'Seasons.totals.STL': 1,    # Int32
    'Seasons.totals.3P': 1,     # Int32
    'Seasons.totals.FT': 1,     # Int32
    'Seasons.totals.BLK': 1,    # Int32
    'Seasons.totals.ORB': 1,    # Int32
    'Seasons.totals.AST': 1,    # Int32
    'Seasons.totals.DRB': 1,    # Int32
    'Seasons.totals.PF': 1,     # Int32
    'Seasons.totals.FTA': 1,    # Int32
    'Seasons.totals.FGA': 1,    # Int32
    'Seasons.totals.FG': 1,     # Int32
    'Seasons.totals.TOV': 1     # Int32
}


# Connect to MongoDB
def connectMongo(db, host='localhost', port=27017, mongo_uri=None):

    """ A util for making a connection to mongo """

    if mongo_uri:
        conn = MongoClient(mongo_uri)
    else:
        conn = MongoClient(host, port)

    return conn[db]

def readMongo(db, collection, query={}, queryReturn=None,
                _limit=None,no_id=True,mongo_uri=None):

    """ Read from Mongo and Store into DataFrame """

    # Connect to MongoDB
    db = connectMongo(db=db, mongo_uri=mongo_uri)

    # Make a query to the specific DB and Collection
    cursor = db[collection].find(query, queryReturn)

    # Check if a limit was set
    if _limit:
        cursor = cursor.limit(_limit)
    # Expand the cursor and construct the DataFrame
    df =  pd.DataFrame(list(cursor))

    # Delete the _id
    if no_id:
        del df['_id']

    return df</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Now lets go over to our <code>runNBA_Data.py</code> and implement our four functions, that's right only for functions. One of those functions I consider a helper, so you know it's short. Lets import our modules at the top of the page.</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:360px"># runNBA_Data.py
import time
import pandas as pd
import numpy as np

# Machine Learning algorithms
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import PolynomialFeatures,scale
from sklearn.cross_validation import train_test_split, KFold
from sklearn.learning_curve import learning_curve

# Plot modules
import matplotlib.pyplot as plt
from matplotlib import style
style.use("ggplot")
pd.options.display.max_columns = 50
pd.set_option('expand_frame_repr', False)

# Custom modules
from nbaImport import readMongo, WANTED_FEATURES, PER_FEATURES</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>If you don't already have the modules installed on your computer/environment, here's the command to install all of them:</p>
            <p class="console">pip install pandas numpy scikit-learn matplotlib pymongo scipy</p>
        </div>
    </div>
</section>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Once you have everything installed, go ahead and run your python script to make sure no errors occur. Since I am using python 3.4, my command looks like the following:</p>
            <p class="console">python3 runNBA_Data.py</p>
        </div>
    </div>
</section>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>If nothing is displayed on the console, then that means were good! Lets continue... </p>
            <p>Paste the following  at the bottom of <code>runNBA_Data.py</code>:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:210px">def flatten(objToFlatten):
    return [item for sublist in objToFlatten for item in sublist]

def BuildDataSet():
    return True, True;

def PlotLearningCurve(X_data, y_data,algorithm, s_time):
    return True;

def Analysis(_deg=1):
    X, y = BuildDataSet()

Analysis()</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>We are going to start off in <code>BuildDataSet()</code>.
                Depending if you are using <a href="https://mongolab.com/home" title="mongolab">mongolab</a> to host your database, you will paste one of the following lines before the <code>return</code> statement:</p>
        </div>
    </div>
</section>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p style="color:red"><u><strong>USING MONGOLAB</strong></u>. <a ng-click='showURI= true' title="What is URI?">What is URI?</a></p>
        </div>
    </div>
</section>
<img ng-show='showURI' class="tutImage" src="images/tutorialImages/mongolab_05.1764ab03.png" alt="mongolab_05.png">
<div class="codeView_python" style="height:130px">
    # 1
    nbaFrame = readMongo(db='YOUR DATABASE',collection='YOUR COLLECTION',
            query= {}, queryReturn=WANTED_FEATURES, no_id=False,
            mongo_uri='YOUR URI')

    # 2
    statsDF = pd.DataFrame(list(flatten(nbaFrame.Seasons)))</div>

<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p style="color:green"><u><strong>NOT USING MONGOLAB</strong></u></p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:115px">
    # 1
    nbaFrame = readMongo(db='YOUR DATABASE',collection='YOUR COLLECTION',
            query= {}, queryReturn=WANTED_FEATURES, no_id=False)

    # 2
    statsDF = pd.DataFrame(list(flatten(nbaFrame.Seasons)))</div>


<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p><u><strong>Part 1</strong></u> - We are using our <code>readMongo()</code> method that we imported. We set <code>query = {}</code> so it would return everything. <code>queryReturn</code> is the <a href="http://docs.mongodb.org/manual/tutorial/project-fields-from-query-results/">projection document</a> of the query. Meaning, it tells mongo:
                <strong>"Hey, I don't care about all that other stuff you're going to return me. All I want back are these values here(WANTED_FEATURES)."</strong>
            </p>
            <p><u><strong>Part 2</strong></u> - Picture <code>DataFrame</code> as a <a href="http://pandas-docs.github.io/pandas-docs-travis/dsintro.html#dataframe">spreadsheet/SQL table</a>.  Since <code>nbaFrame.Seasons</code> returns an array of <strong>objects</strong>, and objects don't go well with spreadsheets. We need to use our <code>flatten()</code> function to  transform our data so it can work with the <code>DataFrame</code>. </p>
            <p>Let's <code>console.lo....</code> I mean, <code>print(statsDF)</code> after we set it. Add the following line after we set <code>statsDF</code>:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:20px">print(statsDF)</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Be sure you have your Mongo DB instant running if you're not using Mongolab. Let's run this code:</p>
            <p class="console">python3 runNBA_Data.py</p>
        </div>
    </div>
</section>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Hopefully should've gotten something similar to this:</p>
        </div>
    </div>
</section>
<img class="tutImage" src="images/tutorialImages/console_13.cc653949.png" alt="console_13.png">

<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Do you see what I'm talking about when I was talking about <code>DataFrame</code> and objects? Goodluck trying to put that in a spreadsheet.</p>
            <p>Let's go ahead and finish up this function, paste the following in <code>BuildDataSet()</code>:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:260px">
    # 1
    stats = pd.DataFrame(list(statsDF.totals.values))
    stats['FT_M'] = stats['FTA'] - stats['FT']
    stats['FG_M'] = stats['FGA'] - stats['FG']
    stats[PER_FEATURES] = stats[PER_FEATURES].astype(float)

    # 2
    stats['PER'] = pd.DataFrame(list(statsDF.advanced.values))

    # 3
    stats = stats.reindex(np.random.permutation(stats.index))
    X = np.array(stats[PER_FEATURES].values)
    y = (stats["PER"].values.tolist())

    return X,y</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p><u><strong>Part 1</strong></u> - Make a new DataFrame object called <code>stats</code> which is set to the values of all the <code>totals</code> stats. We make a new features called <code>FT_M</code> and <code>FG_M</code> which calculate <code>free throws missed</code> and <code>field goals missed</code>. Lastly, we convert all the numbers to floats.</p>
            <p><u><strong>Part 2</strong></u> - We add <code>PER</code> to the <code>stats</code> from the <code>advanced</code> stats.</p>
            <p><u><strong>Part 3</strong></u> - We are randomizing our data, which is very common in machine learning. Next we are setting our input<code>X</code> and output <code>y</code>. </p>
            <p>Now to our <code>PlotLearningCurve()</code>, I am not going to go into detail as to how the machine learning portion is working. I will however, be referencing documentation which goes into much more detail and contains examples. </p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:500px">def PlotLearningCurve(X_data, y_data,algorithm, s_time):

    print('PlotLearningCurve called')

    # 1
    sizes = np.array([.1,.2,.5,.8,.99])

    train_sizes, train_scores, test_scores = learning_curve(
                                                    algorithm,
                                                    X_data,
                                                    y_data,
                                                    train_sizes=sizes)
    print('after learning_curve')
    train_mean = np.mean(train_scores, axis=1)
    train_std = np.std(train_scores, axis=1)
    test_mean = np.mean(test_scores, axis=1)
    test_std = np.std(test_scores, axis=1)

    # 2
    plt.figure(figsize=(15,10)) # Width, Height

    # Training Set
    plt.fill_between(train_sizes, train_mean-train_std,
                    train_mean+train_std, alpha=0.1, color="r")

    # Cross Validation Set
    plt.fill_between(train_sizes, test_mean-test_std,
                    test_mean+test_std, alpha=0.1, color="g")

    # Graph Legend text
    trainLabel = ('%.3f%% Training score' % (train_mean[4]))
    testLabel = ('%.3f%% Cross-validation score' % (test_mean[4]))

    # Plot lines
    plt.plot(train_sizes, train_mean, 'o-', color="r", label=trainLabel)
    plt.plot(train_sizes, test_mean, 'o-', color="g", label=testLabel)

    # Place title, X-axis label, Y-axis label
    plt.suptitle('Linear Regression: NBA PER', fontsize=20)
    plt.xlabel('Training examples')
    plt.ylabel('Accuracy')

    # Set limit on Y-axis, Place graph legend
    plt.ylim((0, 1.1))
    plt.legend(loc="best")

    # Print duration of program
    print("--- %s seconds ---" % (time.time() - s_time))
    plt.show()</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p><u><strong>Part 1</strong></u> - Machine Learning: <code><a href="http://scikit-learn.org/stable/modules/generated/sklearn.learning_curve.learning_curve.html#sklearn.learning_curve.learning_curve">learning_curve()</a></code> returns the data we need for our graph. So you have an idea of what a learning curve looks like, check out <a href="http://scikit-learn.org/stable/modules/learning_curve.html#learning-curve">this example</a>. The variables <code>algorithm</code>, <code>X_data</code>, and <code>y_data</code> will make more sense when we get to the <code>Analysis()</code> function. Our variable <code>sizes</code> tells our <code>learning_curve()</code>, "Hey, I want you to calculate the measurements at <strong><u>10%</u></strong>, <strong><u>20%</u></strong>, <strong><u>50%</u></strong>, <strong><u>80%</u></strong>, and <strong><u>99%</u></strong>." The variables ending in <code>_mean</code> and <code>_std</code> are simply the measurements of the <a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.mean.html">average</a> and the <a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.std.html">standard deviation</a> at each of the precentages.</p>
            <p><u><strong>Part 2</strong></u> - Plot Graph: Here we are placing the data onto the graph and finally displaying it at the end. I put comments to help explain what's going on since it's pretty straightforward. Just setting up labels, legends, titles, etc.</p>
            <p>Finally, let's finish up this program with <code>Analysis()</code>:
        </div>
    </div>
</section>
<div class="codeView_python" style="height:295px">def Analysis(_deg=1):
    start_time = time.time()

    # 1
    X, y = BuildDataSet()
    linear_regression = LinearRegression()

    # 2
    polynomial_features = PolynomialFeatures(degree=_deg, include_bias=False)

    # 3
    algorithm = Pipeline([("polynomial_features", polynomial_features),
                         ("linear_regression", linear_regression)])
    #========================================================================== */
    print('after Pipeline')

    # 4
    PlotLearningCurve(X, y, algorithm, start_time)</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p><u><strong>Part 1</strong></u> - Here we get our <code>X</code> and <code>y</code> which we get returned from <code>BuildDataSet()</code>. Next, we make a new variable called <code>linear_regression</code> which is set to our imported <code><a href="http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression">LinearRegression()</a></code> algorithm class. </p>
            <p><u><strong>Part 2</strong></u> - We're going to be adding <code><a href="http://scikit-learn.org/stable/auto_examples/model_selection/plot_underfitting_overfitting.html#example-model-selection-plot-underfitting-overfitting-py">Polynomial Features</a></code> to our algorithm. <a href="https://class.coursera.org/ml-005/lecture/23">This video</a> by Andrew Ng does in extraordinary job explaining the importance of this. I will be speaking about Andrew's course in the conclusion of this tutorial.</p>
            <p><u><strong>Part 3</strong></u> - we need to use our <code><a href="http://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html">Pipeline</a></code> class to combine <code>polynomial_features</code> to our <code>LinearRegression()</code> algorithm.</p>
            <p><u><strong>Part 4</strong></u> - lastly, we pass in our <code>X</code>, <code>y</code>, and <code>algorithm</code> as arguments to <code>PlotLearningCurve()</code>.</p>
            <p>Are y'all ready to predict a player's PER? Lets do one last checkup before running it.</p>
            <h3 class="heading multiColor" id="code-checkup_1">Code CheckUp</h3>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:500px"># runNBA_Data.py

import time
import pandas as pd
import numpy as np

# Machine Learning algorithms
from sklearn.pipeline import Pipeline
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import PolynomialFeatures,scale
from sklearn.cross_validation import train_test_split, KFold
from sklearn.learning_curve import learning_curve

# Plot modules
import matplotlib.pyplot as plt
from matplotlib import style
style.use("ggplot")
pd.options.display.max_columns = 50
pd.set_option('expand_frame_repr', False)

# Custom modules
from nbaImport import readMongo, WANTED_FEATURES, PER_FEATURES

def flatten(objToFlatten):
    return [item for sublist in objToFlatten for item in sublist]

def BuildDataSet():

    ###### USING MONGOLAB ######
    nbaFrame = readMongo(db='YOUR DATABASE',collection='YOUR COLLECTION',
            query= {}, queryReturn=WANTED_FEATURES, no_id=False,
            mongo_uri='YOUR URI')

    ###### NOT USING MONGOLAB ######
    nbaFrame = readMongo(db='YOUR DATABASE',collection='YOUR COLLECTION',
            query= {}, queryReturn=WANTED_FEATURES, no_id=False)

    ##################################################################

    statsDF = pd.DataFrame(list(flatten(nbaFrame.Seasons)))

    stats = pd.DataFrame(list(statsDF.totals.values))
    stats['FT_M'] = stats['FTA'] - stats['FT']
    stats['FG_M'] = stats['FGA'] - stats['FG']
    stats[PER_FEATURES] = stats[PER_FEATURES].astype(float)

    stats['PER'] = pd.DataFrame(list(statsDF.advanced.values))

    # 3
    stats = stats.reindex(np.random.permutation(stats.index))
    X = np.array(stats[PER_FEATURES].values)
    y = (stats["PER"].values.tolist())

    return X,y

def PlotLearningCurve(X_data, y_data,algorithm, s_time):

    print('PlotLearningCurve called')

    sizes = np.array([.1,.2,.5,.8,.99])

    train_sizes, train_scores, test_scores = learning_curve(
                                                    algorithm,
                                                    X_data,
                                                    y_data,
                                                    train_sizes=sizes)
    print('after learning_curve')
    train_mean = np.mean(train_scores, axis=1)
    train_std = np.std(train_scores, axis=1)
    test_mean = np.mean(test_scores, axis=1)
    test_std = np.std(test_scores, axis=1)

    plt.figure(figsize=(15,10)) # Width, Height

    # Training Set
    plt.fill_between(train_sizes, train_mean-train_std,
                    train_mean+train_std, alpha=0.1, color="r")

    # Cross Validation Set
    plt.fill_between(train_sizes, test_mean-test_std,
                    test_mean+test_std, alpha=0.1, color="g")

    # Graph Legend text
    trainLabel = ('%.3f%% Training score' % (train_mean[4]))
    testLabel = ('%.3f%% Cross-validation score' % (test_mean[4]))

    # Plot lines
    plt.plot(train_sizes, train_mean, 'o-', color="r", label=trainLabel)
    plt.plot(train_sizes, test_mean, 'o-', color="g", label=testLabel)

    # Place title, X-axis label, Y-axis label
    plt.suptitle('Linear Regression: NBA PER', fontsize=20)
    plt.xlabel('Training examples')
    plt.ylabel('Accuracy')

    # Set limit on Y-axis, Place graph legend
    plt.ylim((0, 1.1))
    plt.legend(loc="best")

    # Print duration of program
    print("--- %s seconds ---" % (time.time() - s_time))
    plt.show()

def Analysis(_deg=1):
    start_time = time.time()

    X, y = BuildDataSet()
    linear_regression = LinearRegression()

    polynomial_features = PolynomialFeatures(degree=_deg, include_bias=False)

    algorithm = Pipeline([("polynomial_features", polynomial_features),
                         ("linear_regression", linear_regression)])
    #========================================================================== */
    print('after Pipeline')

    PlotLearningCurve(X, y, algorithm, start_time)

Analysis()</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Be sure to have mongodb running, if you are not using Mongolab.</p>
            <p>lets run it:</p>
            <p class="console">python3 runNBA_Data.py</p>
        </div>
    </div>
</section>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Did you get something like this:</p>
        </div>
    </div>
</section>
<img class="tutImage" src="images/tutorialImages/prediction_01.9193ea18.png" alt="prediction_01.png">
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>I bet you're saying, "Fabian, what the hell man? I thought you said <strong>95%</strong>!?!? What the hell is this <strong>40%</strong> that I'm seeing?!? <strong><em><a href="https://www.youtube.com/watch?v=zT8QQr6MjBo">I can't get jiggy with this!!</a></em></strong> ." I know, I know!! Something went wrong, I think we might have missed something, lets go back to <a ui-sref="blog.NBA_Machine_Learning_Tutorial1" title="Chapter 1">Chapter 1</a> and redo it all..... Nah I'm just kidding, when I first saw this, It kinda scared me. But don't worry, I got this. Lets open up <a href="http://www.basketball-reference.com/leagues/NBA_2015_advanced.html">basketball-reference</a> in a new tab, and click on the <strong>PER</strong> stat, like so:</p>
        </div>
    </div>
</section>
<img class="tutImage" src="images/tutorialImages/bb_ref_01.3c4e6758.png" alt="bb_ref_01.png">
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>It should put all the <strong>PER</strong> stats in descending order. As you see, our data could use a bit more cleaning. There's no way <strong><em>Sim Bhullar</em></strong> should have a higher PER than <strong>Anthony Davis</strong>, <strong>Stephen Curry</strong>, and especially the best 2-Guard in the game right now, <strong>James Harden</strong>. Some may find that last statement a bit biased, I don't know, you tell me, does this gif lie?</p>
        </div>
    </div>
</section>
<img class="tutImage" src="images/tutorialImages/jamesHarden.5d25f3f5.gif" alt="jamesHarden.gif">
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>I see what's going on, it's the amount of games(G) the player has played. Thats why <strong><em>Sim Bhullar</em></strong> has a high PER. </p>
            <p>I know what you're thinking, "Fabian, are we going to have to go back to <a ui-sref="blog.NBA_Machine_Learning_Tutorial2" title="Chapter 2">Chapter 2</a> and redo something?" The answer is "if I was an asshole, I would make you do that, but I'm not. So I'll tell you what to do." We're going to make a new collection in our database that will not include seasons from players who did not play a certain amount of games. <strong><em>Derrick Rose</em></strong> will act as our example. We will use all the seasons Derrick has played except his <strong><em>'12-'13</em></strong> and <strong><em>'13-'14</em></strong> seasons for which he was hurt. </p>
            <p>Let's open up <code>Robomongo</code> and run the following command:</p>
        </div>
    </div>
</section>
<div class="codeView" style="height:195px">db.players.aggregate(
  {$unwind: "$Seasons"},
  {$match: {"Seasons.advanced.G": { $gt:50 }}},
  {$group: {
        _id: "$_id",
        Player: {$first:"$$ROOT.Player"},
        Pos: {$first:"$$ROOT.Pos"},
        Seasons:{ $push: "$Seasons"}}
    },
  {$out:"above50Games"})</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p><strong><em>Be sure to right click <code>collections</code> on the sidebar and click <code>refresh</code>.</em></strong> This will make our new collection <code>above50Games</code> show up on the sidebar. You should get something like this returned:</p>
        </div>
    </div>
</section>
<img class="tutImage" src="images/tutorialImages/robomongo_02.120e7794.png" alt="robomongo_02.png">
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>This function will make our new <code>above50Games</code> collection be identical to our <code>players</code> collection. Of course, with the exception that it removes any season where the player has played less than 50 games. </p>
            <p><strong><em>Why did I choose 50 games?</em></strong> I tried a few numbers like 35, 50, 55. Having a minimum of 50 games seemed to give me the best results.</p>
            <p>OK let's go back to <code>runNBA_Data.py</code> and make a few changes inside of our <code>BuildDataSet()</code> function. Change <code>readMongo()</code> to get data from <code>above50Games</code> instead of <code>players</code>:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:35px">nbaFrame = readMongo(db='YOUR DATABASE',"above50Games", query= {}, queryReturn=WANTED_FEATURES, no_id=False)</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Lets run it:</p>
            <p class="console">python3 runNBA_Data.py</p>
        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Hopefully you got something like this:</p>
        </div>
        <div class="col-xs-12">
            <img class="tutImage" src="images/tutorialImages/prediction_02.61ed8c6e.png" alt="prediction_02.png">
        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>I'm sure you're saying:
                <strong><em>"Fabian 85% does not equal 95%! I'm getting really close to just leaving this tutorial! I'm tired of you playing with my emotions!!"</em></strong>
            </p>
        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>OK I'm sorry this is the last fix, <strong><em>I PROMISE!</em></strong> Remember that <code>polynomial_features</code>? Since <code>_deg</code> gets set to 1 in <code>Analysis(_deg=1)</code>, we aren't taking advantage of that feature. So at the very bottom of the page, the very last line, where you see <code>Analysis()</code> all by itself. Replace it with this:</p>
        </div>
        <div class="col-xs-12">
            <div class="codeView_python" style="height:20px">Analysis(2)</div>
        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>and then run it. Watch your accuracy shoot up! By the way, it may take a little longer than before.
                Lets try <code>3</code> next.
            </p>
        </div>
        <div class="col-xs-12">
            <div class="codeView_python" style="height:20px">Analysis(3)</div>
        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>You hopefully should've gotten this:</p>
        </div>
        <div class="col-xs-12">
            <img class="tutImage" src="images/tutorialImages/prediction_03.323fbfa2.png" alt="prediction_03.png">
        </div>
        <div class="col-xs-12">
            <p class="humorText"><u><strong>There's your <em>95% + 1</em>!</strong></u></p>
            <img class="tutImage" src="images/tutorialImages/drop_MIC.1ac6f159.gif" alt="drop_MIC.gif">
        </div>
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Let's zoom into the graph a bit. At the end of <code>PlotLearningCurve()</code>, replace the following lines:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:35px">plt.ylim((0, 1.1))
plt.legend(loc="best")</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>with:</p>
        </div>
    </div>
</section>
<div class="codeView_python" style="height:50px">plt.ylim((0.5, 1.1))
plt.xlim((0, 6500))
plt.legend(loc="best")</div>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1 col-lg-8 col-lg-offset-2">
            <p>Looks a lot better don't you say?</p>
        </div>
    </div>
</section>
<img class="tutImage" src="images/tutorialImages/prediction_04.2518c0fa.png" alt="prediction_04.png">
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1">
            <h2 class="heading multiColor" id="conclusion">Conclusion</h2>
            <p>I hope you were able to take something away from this tutorial. Machine learning is a very exciting field and I highly recommend you look into it. As you see, it takes more time to collect and clean data than the actual Machine Learning part. Machine Learning is all about theory: </p>
            <ul>
                <li>what are you trying to predict.</li>
                <li>what are your features.</li>
                <li>what algorithm are you going to use.</li>
            </ul>
            <p>Machine learning is nothing like programming. In programming, you can grind it out. Meaning, you can work when your body is completely drained and still get something done. Machine learning is not like that, you need to have a clear mind and really understand your data.</p>
        </div>
    </div>
</section>
<section class="container">
    <div class="row">
        <div class="col-xs-12 col-md-10 col-md-offset-1">
            <p>I want to thank <a href="basketball-reference.com/?lid=homepage_logo">basketball-reference</a> and all the hard working teams involved for allowing me to use their data. I also want to thank Sean Forman for allowing me to make their data available for download on this tutorial. I want to thank Andrew Ng for his amazing <a href="https://www.coursera.org/learn/machine-learning/home/info"><strong>FREE</strong> Machine Learning course on coursera</a>. Lastly, I want to thank <a href="https://www.youtube.com/user/sentdex">sentdex</a> for his great <a href="https://www.youtube.com/playlist?list=PLQVvvaa0QuDd0flgGphKCej-9jp-QdzZ3">python machine learning tutorials</a> on YouTube. Both sentdex and Andrew's videos really helped out! I recommend you watch them(Andrew's before sentdex) if you want to get into Machine Learning. If you've made it all the way down to this sentence here, I want to personally thank you for taking the time out of your day to do this tutorial. I hope you took something away from it, but most importantly, I hope you had a good time. Any feedback would be appreciated. Thank you again!</p>
            <p class="pull-right"><em>-Fabian Buentello</em></p>
        </div>
    </div>
</section>